# Story 2.8: 노트 작성 중 임시 저장

## Status
Draft

## Story
**As a** 사용자,
**I want** 노트 작성 중 자동으로 임시 저장되도록,
**so that** 예상치 못한 상황에서도 작성 중인 내용을 잃지 않는다

## Acceptance Criteria

1. **자동 임시 저장**
   - 타이핑 중 3초 후 자동 저장
   - 로컬 스토리지에 임시 데이터 저장
   - 페이지 새로고침 시 임시 데이터 복구

2. **임시 저장 상태 표시**
   - 저장 중 상태 시각적 표시
   - 저장 완료 확인 표시
   - 저장 실패 시 에러 메시지

3. **임시 데이터 관리**
   - 노트별 임시 데이터 분리 저장
   - 임시 데이터 만료 시간 설정 (24시간)
   - 정식 저장 시 임시 데이터 삭제

4. **사용자 제어**
   - 수동 저장 버튼 제공
   - 임시 저장 비활성화 옵션
   - 임시 데이터 수동 삭제

5. **에러 처리**
   - 저장 실패 시 재시도 로직
   - 네트워크 오프라인 상태 처리
   - 저장 공간 부족 시 경고

## Tasks / Subtasks

- [ ] 임시 저장 로직 구현 (AC: 1, 3)
  - [ ] 로컬 스토리지 관리
  - [ ] 디바운스 타이머 구현
  - [ ] 임시 데이터 만료 처리

- [ ] 임시 저장 Server Action 구현 (AC: 1)
  - [ ] 임시 저장 API 엔드포인트
  - [ ] 임시 데이터 검증
  - [ ] 임시 데이터 저장

- [ ] 임시 저장 UI 구현 (AC: 2, 4)
  - [ ] 저장 상태 표시 컴포넌트
  - [ ] 수동 저장 버튼
  - [ ] 설정 옵션 UI

- [ ] 데이터 복구 기능 구현 (AC: 1)
  - [ ] 페이지 로드 시 임시 데이터 복구
  - [ ] 임시 데이터 유효성 검증
  - [ ] 복구 확인 다이얼로그

- [ ] 에러 처리 및 재시도 (AC: 5)
  - [ ] 저장 실패 시 재시도 로직
  - [ ] 오프라인 상태 감지
  - [ ] 저장 공간 부족 경고

- [ ] 단위 테스트 작성
  - [ ] 임시 저장 로직 테스트
  - [ ] 데이터 복구 테스트
  - [ ] 에러 처리 테스트

## Dev Notes

### 데이터 모델
- **draft_notes 테이블**: `id`, `userId`, `title`, `content`, `createdAt`, `expiresAt`
- **로컬 스토리지**: `draft_${noteId}` 키로 임시 데이터 저장

### API 스펙
```typescript
// Server Actions
async function saveDraft(noteId: string, data: { title: string, content: string }) {
  // 반환값: { success: boolean, error?: string }
}

async function getDraft(noteId: string) {
  // 반환값: { success: boolean, data?: DraftNote, error?: string }
}

async function deleteDraft(noteId: string) {
  // 반환값: { success: boolean, error?: string }
}
```

### 컴포넌트 구조
```
components/notes/
├── DraftManager.tsx (임시 저장 관리)
├── DraftIndicator.tsx (저장 상태 표시)
├── DraftRecovery.tsx (데이터 복구)
└── DraftSettings.tsx (설정 옵션)
```

### 파일 위치
- **Server Action**: `lib/actions/drafts.ts`
- **컴포넌트**: `components/notes/`
- **훅**: `lib/hooks/useDraft.ts`
- **테스트**: `__tests__/notes/`

### 기술적 제약사항
- 로컬 스토리지와 서버 동기화
- 디바운스 로직 구현
- Next.js App Router 사용
- shadcn/ui 컴포넌트 활용
- TypeScript 사용

### Testing
- **테스트 위치**: `__tests__/notes/`
- **테스트 프레임워크**: Jest + React Testing Library
- **테스트 범위**: 
  - 임시 저장 로직 테스트
  - 데이터 복구 테스트
  - 에러 처리 테스트
  - 사용자 상호작용 테스트

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-14 | 1.0 | 초기 스토리 생성 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
*이 섹션은 개발 에이전트가 구현 중에 채워집니다*

### Debug Log References
*이 섹션은 개발 에이전트가 구현 중에 채워집니다*

### Completion Notes List
*이 섹션은 개발 에이전트가 구현 중에 채워집니다*

### File List
*이 섹션은 개발 에이전트가 구현 중에 채워집니다*

## QA Results
*이 섹션은 QA 에이전트가 검토 후에 채워집니다*


