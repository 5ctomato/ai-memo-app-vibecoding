# Story 2.4: 노트 수정 및 실시간 저장

## Status
Draft

## Story
**As a** 사용자,
**I want** 기존 노트를 수정하고 실시간으로 저장할 수 있도록,
**so that** 노트 내용을 업데이트하고 데이터 손실을 방지할 수 있다

## Acceptance Criteria

1. **노트 수정 기능**
   - 노트 제목과 본문을 수정할 수 있음
   - 기존 내용이 폼에 미리 채워져 있음
   - 수정 권한이 있는 사용자만 수정 가능

2. **실시간 저장**
   - 타이핑 중 3초 후 자동 저장
   - 저장 상태를 시각적으로 표시 (저장 중, 저장 완료, 저장 실패)
   - 네트워크 오류 시 재시도 로직

3. **수정 내역 추적**
   - 수정일시 자동 업데이트
   - 수정 전후 내용 비교 (선택사항)
   - 수정 히스토리 표시

4. **사용자 경험**
   - 수정 중 페이지 이탈 시 경고 메시지
   - 키보드 단축키 지원 (Ctrl+S)
   - 반응형 에디터 인터페이스

5. **에러 처리**
   - 저장 실패 시 사용자에게 알림
   - 충돌 감지 및 해결 방안 제시
   - 네트워크 연결 상태 표시

## Tasks / Subtasks

- [ ] 노트 수정 Server Action 구현 (AC: 1, 3)
  - [ ] 노트 업데이트 쿼리 작성
  - [ ] 수정 권한 검증
  - [ ] 수정일시 자동 업데이트

- [ ] 실시간 저장 기능 구현 (AC: 2)
  - [ ] 디바운스 로직 구현
  - [ ] 자동 저장 Server Action
  - [ ] 저장 상태 관리

- [ ] 노트 수정 페이지 구현 (AC: 1, 4)
  - [ ] `/notes/[id]/edit` 페이지 생성
  - [ ] 수정 폼 컴포넌트
  - [ ] 기존 데이터 로딩

- [ ] 실시간 저장 UI 구현 (AC: 2, 5)
  - [ ] 저장 상태 표시 컴포넌트
  - [ ] 에러 메시지 표시
  - [ ] 네트워크 상태 표시

- [ ] 사용자 경험 개선 (AC: 4)
  - [ ] 페이지 이탈 경고
  - [ ] 키보드 단축키 지원
  - [ ] 반응형 에디터

- [ ] 단위 테스트 작성
  - [ ] Server Action 테스트
  - [ ] 실시간 저장 로직 테스트
  - [ ] 에러 케이스 테스트

## Dev Notes

### 데이터 모델
- **notes 테이블**: `id`, `userId`, `title`, `content`, `updatedAt`
- **수정 필드**: `title`, `content`, `updatedAt`
- **인덱스**: `id` (Primary Key), `userId` (권한 검증)

### API 스펙
```typescript
// Server Action
async function updateNote(noteId: string, data: { title: string, content: string }) {
  // 반환값: { success: boolean, data?: Note, error?: string }
}

async function autoSaveNote(noteId: string, data: { title: string, content: string }) {
  // 반환값: { success: boolean, error?: string }
}
```

### 컴포넌트 구조
```
/notes/[id]/edit/page.tsx (수정 페이지)
├── components/notes/
│   ├── EditNoteForm.tsx (수정 폼)
│   ├── AutoSaveIndicator.tsx (저장 상태)
│   ├── SaveStatus.tsx (저장 상태 표시)
│   └── NetworkStatus.tsx (네트워크 상태)
```

### 파일 위치
- **Server Action**: `lib/actions/notes.ts`
- **페이지**: `app/notes/[id]/edit/page.tsx`
- **컴포넌트**: `components/notes/`
- **테스트**: `__tests__/notes/`

### 기술적 제약사항
- DrizzleORM을 사용한 데이터베이스 업데이트
- Next.js App Router 동적 라우팅 사용
- 실시간 저장을 위한 디바운스 로직
- shadcn/ui 컴포넌트 활용
- TypeScript 사용

### Testing
- **테스트 위치**: `__tests__/notes/`
- **테스트 프레임워크**: Jest + React Testing Library
- **테스트 범위**: 
  - Server Action 단위 테스트
  - 실시간 저장 로직 테스트
  - 사용자 상호작용 테스트
  - 에러 케이스 테스트

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-14 | 1.0 | 초기 스토리 생성 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
*이 섹션은 개발 에이전트가 구현 중에 채워집니다*

### Debug Log References
*이 섹션은 개발 에이전트가 구현 중에 채워집니다*

### Completion Notes List
*이 섹션은 개발 에이전트가 구현 중에 채워집니다*

### File List
*이 섹션은 개발 에이전트가 구현 중에 채워집니다*

## QA Results
*이 섹션은 QA 에이전트가 검토 후에 채워집니다*



