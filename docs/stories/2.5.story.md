# Story 2.5: 노트 삭제 및 복구

## Status
Draft

## Story
**As a** 사용자,
**I want** 노트를 삭제하고 필요시 복구할 수 있도록,
**so that** 불필요한 노트를 정리하면서도 실수로 삭제한 노트를 복구할 수 있다

## Acceptance Criteria

1. **노트 삭제 기능**
   - 노트를 소프트 삭제 (isArchived = true)
   - 삭제 확인 다이얼로그 표시
   - 삭제 권한이 있는 사용자만 삭제 가능

2. **삭제된 노트 관리**
   - 삭제된 노트는 별도 목록에서 확인 가능
   - 삭제된 노트는 일반 목록에서 숨김
   - 삭제일시 기록 및 표시

3. **노트 복구 기능**
   - 삭제된 노트를 원래 상태로 복구
   - 복구 확인 다이얼로그 표시
   - 복구 후 일반 목록에 다시 표시

4. **영구 삭제 기능**
   - 삭제된 노트를 데이터베이스에서 완전 제거
   - 영구 삭제 확인 다이얼로그 (2단계 확인)
   - 복구 불가능한 작업임을 명시

5. **사용자 경험**
   - 삭제/복구 작업 후 적절한 피드백 제공
   - 휴지통 아이콘으로 삭제된 노트 표시
   - 대량 삭제/복구 기능 (선택사항)

## Tasks / Subtasks

- [ ] 노트 삭제 Server Action 구현 (AC: 1)
  - [ ] 소프트 삭제 쿼리 작성
  - [ ] 삭제 권한 검증
  - [ ] 삭제일시 기록

- [ ] 노트 복구 Server Action 구현 (AC: 3)
  - [ ] 복구 쿼리 작성
  - [ ] 복구 권한 검증
  - [ ] 복구 후 상태 업데이트

- [ ] 영구 삭제 Server Action 구현 (AC: 4)
  - [ ] 하드 삭제 쿼리 작성
  - [ ] 관련 데이터 정리
  - [ ] 삭제 로그 기록

- [ ] 삭제/복구 UI 컴포넌트 구현 (AC: 1, 3, 4)
  - [ ] 삭제 확인 다이얼로그
  - [ ] 복구 확인 다이얼로그
  - [ ] 영구 삭제 확인 다이얼로그

- [ ] 휴지통 페이지 구현 (AC: 2)
  - [ ] 삭제된 노트 목록 페이지
  - [ ] 복구/영구삭제 액션 버튼
  - [ ] 삭제일시 표시

- [ ] 단위 테스트 작성
  - [ ] Server Action 테스트
  - [ ] 컴포넌트 테스트
  - [ ] 권한 검증 테스트

## Dev Notes

### 데이터 모델
- **notes 테이블**: `id`, `userId`, `title`, `content`, `isArchived`, `deletedAt`
- **삭제 필드**: `isArchived`, `deletedAt`
- **인덱스**: `userId`, `isArchived`, `deletedAt`

### API 스펙
```typescript
// Server Actions
async function deleteNote(noteId: string) {
  // 반환값: { success: boolean, error?: string }
}

async function restoreNote(noteId: string) {
  // 반환값: { success: boolean, error?: string }
}

async function permanentDeleteNote(noteId: string) {
  // 반환값: { success: boolean, error?: string }
}

async function getDeletedNotes() {
  // 반환값: { success: boolean, data?: Note[], error?: string }
}
```

### 컴포넌트 구조
```
/notes/trash/page.tsx (휴지통 페이지)
├── components/notes/
│   ├── DeleteConfirmDialog.tsx (삭제 확인)
│   ├── RestoreConfirmDialog.tsx (복구 확인)
│   ├── PermanentDeleteDialog.tsx (영구삭제 확인)
│   ├── TrashNoteList.tsx (휴지통 목록)
│   └── TrashNoteCard.tsx (휴지통 노트 카드)
```

### 파일 위치
- **Server Action**: `lib/actions/notes.ts`
- **페이지**: `app/notes/trash/page.tsx`
- **컴포넌트**: `components/notes/`
- **테스트**: `__tests__/notes/`

### 기술적 제약사항
- DrizzleORM을 사용한 데이터베이스 업데이트
- 소프트 삭제 패턴 사용
- Next.js App Router 사용
- shadcn/ui 컴포넌트 활용
- TypeScript 사용

### Testing
- **테스트 위치**: `__tests__/notes/`
- **테스트 프레임워크**: Jest + React Testing Library
- **테스트 범위**: 
  - Server Action 단위 테스트
  - 컴포넌트 렌더링 테스트
  - 사용자 상호작용 테스트
  - 권한 검증 테스트

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-14 | 1.0 | 초기 스토리 생성 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
*이 섹션은 개발 에이전트가 구현 중에 채워집니다*

### Debug Log References
*이 섹션은 개발 에이전트가 구현 중에 채워집니다*

### Completion Notes List
*이 섹션은 개발 에이전트가 구현 중에 채워집니다*

### File List
*이 섹션은 개발 에이전트가 구현 중에 채워집니다*

## QA Results
*이 섹션은 QA 에이전트가 검토 후에 채워집니다*



