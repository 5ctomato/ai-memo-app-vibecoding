# Story 2.9: 노트 검색 기능

## Status
Draft

## Story
**As a** 사용자,
**I want** 노트를 제목과 내용으로 검색할 수 있도록,
**so that** 원하는 정보를 빠르게 찾을 수 있다

## Acceptance Criteria

1. **검색 기능**
   - 제목과 내용에서 키워드 검색
   - 실시간 검색 결과 표시
   - 대소문자 구분 없는 검색

2. **검색 UI**
   - 검색 입력 필드 제공
   - 검색 결과 하이라이트
   - 검색 결과 개수 표시

3. **검색 결과**
   - 검색어와 일치하는 부분 하이라이트
   - 검색 결과 정렬 (관련도순)
   - 검색 결과 페이지네이션

4. **고급 검색**
   - 제목만 검색 옵션
   - 내용만 검색 옵션
   - 날짜 범위 검색 (선택사항)

5. **사용자 경험**
   - 검색 히스토리 저장
   - 인기 검색어 표시
   - 검색어 자동완성 (선택사항)

## Tasks / Subtasks

- [ ] 검색 Server Action 구현 (AC: 1, 3)
  - [ ] 전체 텍스트 검색 쿼리 작성
  - [ ] 검색 결과 정렬 로직
  - [ ] 검색 성능 최적화

- [ ] 검색 UI 컴포넌트 구현 (AC: 2)
  - [ ] 검색 입력 필드
  - [ ] 검색 결과 목록
  - [ ] 검색 결과 하이라이트

- [ ] 실시간 검색 구현 (AC: 1)
  - [ ] 디바운스 검색 로직
  - [ ] 검색 상태 관리
  - [ ] 로딩 상태 표시

- [ ] 고급 검색 기능 (AC: 4)
  - [ ] 검색 옵션 필터
  - [ ] 날짜 범위 검색
  - [ ] 검색 옵션 UI

- [ ] 검색 경험 개선 (AC: 5)
  - [ ] 검색 히스토리 저장
  - [ ] 인기 검색어 표시
  - [ ] 검색어 자동완성

- [ ] 단위 테스트 작성
  - [ ] 검색 로직 테스트
  - [ ] UI 컴포넌트 테스트
  - [ ] 성능 테스트

## Dev Notes

### 데이터 모델
- **notes 테이블**: `id`, `userId`, `title`, `content`, `createdAt`, `updatedAt`
- **검색 인덱스**: `title`, `content`에 대한 전체 텍스트 검색 인덱스
- **search_history 테이블**: `userId`, `query`, `searchedAt` (선택사항)

### API 스펙
```typescript
// Server Action
async function searchNotes(params: {
  query: string;
  page?: number;
  limit?: number;
  searchIn?: 'all' | 'title' | 'content';
  dateFrom?: Date;
  dateTo?: Date;
}) {
  // 반환값: { success: boolean, data?: { notes, pagination, highlights }, error?: string }
}
```

### 컴포넌트 구조
```
components/search/
├── SearchInput.tsx (검색 입력)
├── SearchResults.tsx (검색 결과)
├── SearchHighlight.tsx (하이라이트)
├── SearchFilters.tsx (검색 필터)
├── SearchHistory.tsx (검색 히스토리)
└── PopularSearches.tsx (인기 검색어)
```

### 파일 위치
- **Server Action**: `lib/actions/search.ts`
- **컴포넌트**: `components/search/`
- **페이지**: `app/search/page.tsx`
- **테스트**: `__tests__/search/`

### 기술적 제약사항
- PostgreSQL 전체 텍스트 검색 활용
- 검색 성능 최적화
- Next.js App Router 사용
- shadcn/ui 컴포넌트 활용
- TypeScript 사용

### Testing
- **테스트 위치**: `__tests__/search/`
- **테스트 프레임워크**: Jest + React Testing Library
- **테스트 범위**: 
  - 검색 로직 테스트
  - UI 컴포넌트 테스트
  - 성능 테스트
  - 사용자 상호작용 테스트

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-14 | 1.0 | 초기 스토리 생성 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
*이 섹션은 개발 에이전트가 구현 중에 채워집니다*

### Debug Log References
*이 섹션은 개발 에이전트가 구현 중에 채워집니다*

### Completion Notes List
*이 섹션은 개발 에이전트가 구현 중에 채워집니다*

### File List
*이 섹션은 개발 에이전트가 구현 중에 채워집니다*

## QA Results
*이 섹션은 QA 에이전트가 검토 후에 채워집니다*


